name: Spin Wheel

on:
  repository_dispatch:
    types: [spin]

jobs:
  render:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y imagemagick curl bc jq

      - name: Generate wheel
        run: |
          chmod +x spin_wheel.sh
          USERS='${{ toJson(github.event.client_payload.users) }}'
          URLS=$(echo "$USERS" | jq -r '.[].photo_url' | tr '\n' ' ')
          ./spin_wheel.sh $URLS

      - name: Send to Telegram
        env:
          BOT_TOKEN: ${{ github.event.client_payload.botToken }}
          CHAT_ID:  ${{ github.event.client_payload.chatid }}
        run: |
          curl -s -X POST "https://api.telegram.org/bot$BOT_TOKEN/sendPhoto" \
            -F chat_id="$CHAT_ID" \
            -F photo=@wheel.png \
            -F caption="ðŸŽ¡ Spin Wheel Generated"
            
